<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOMBERKILLER!</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:white;
  font-family:Arial, sans-serif;
  text-align:center;
}
h1{color:#ff0033;}
button{
  padding:15px 25px;
  font-size:18px;
  border:none;
  border-radius:10px;
  background:#ff0033;
  color:white;
  margin:10px;
  cursor:pointer;
}
.card{
  background:#1a1a1a;
  padding:20px;
  margin:20px;
  border-radius:12px;
}
.hidden{display:none;}
.timer{
  font-size:50px;
  color:#00ffd5;
}
.warning{
  color:gold;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>üí£ BOMBERKILLER!</h1>

<!-- SETUP -->
<div id="setup">
  <p>Numero giocatori</p>
  <input type="number" id="numPlayers" value="10" min="5" max="15">
  <br>
  <button onclick="startGame()">INIZIA</button>
</div>

<!-- RUOLI -->
<div id="roleScreen" class="hidden">
  <h2>Giocatore <span id="playerNum"></span></h2>
  <button onclick="showRole()">Mostra il mio ruolo</button>
  <div id="roleCard" class="card hidden"></div>
  <button id="nextBtn" class="hidden" onclick="nextPlayer()">PASSA IL TELEFONO</button>
</div>

<!-- TIMER -->
<div id="timerScreen" class="hidden">
  <h2>Discussione</h2>
  <div id="timer" class="timer">03:00</div>
  <p id="hint" class="warning hidden">
    ‚ö†Ô∏è Vittima: puoi dare ORA un indizio!
  </p>
</div>

<!-- VOTO -->
<div id="voteScreen" class="hidden">
  <h2>üó≥Ô∏è VOTAZIONE</h2>
  <p>Votate l‚ÄôAssassino</p>
  <div id="voteButtons"></div>
</div>

<!-- RISULTATO -->
<div id="resultScreen" class="hidden">
  <h2 id="resultTitle"></h2>
  <p id="resultText"></p>
</div>

<script>
let roles = [];
let votes = [];
let currentPlayer = 0;
let votePlayer = 0;
let assassin = -1;
let victim = -1;
let secret = "";

const secrets = [
  "Siamo al cinema",
  "Siamo in gita al mare",
  "Stiamo organizzando una festa",
  "Siamo a un matrimonio",
  "Siamo in campeggio"
];

// START
function startGame(){
  let n = parseInt(numPlayers.value);
  roles = Array(n).fill("Civile");
  votes = Array(n).fill(0);

  assassin = Math.floor(Math.random()*n);
  roles[assassin] = "Assassino";

  do{
    victim = Math.floor(Math.random()*n);
  } while(victim === assassin);
  roles[victim] = "Vittima";

  secret = secrets[Math.floor(Math.random()*secrets.length)];

  setup.classList.add("hidden");
  roleScreen.classList.remove("hidden");
  updateRoleScreen();
}

// RUOLI
function updateRoleScreen(){
  playerNum.textContent = currentPlayer + 1;
  roleCard.classList.add("hidden");
  nextBtn.classList.add("hidden");
}

function showRole(){
  let r = roles[currentPlayer];
  let text = "";

  if(r === "Civile"){
    text = `
      <h3>üë§ CIVILE</h3>
      <p>Vicenda segreta:</p>
      <p><b>${secret}</b></p>
      <p>Scopri chi non la conosce</p>
    `;
  }

  if(r === "Vittima"){
    text = `
      <h3>ü©∏ VITTIMA</h3>
      <p>Vicenda segreta:</p>
      <p><b>${secret}</b></p>
      <p>‚ö†Ô∏è Non parlare fino agli ultimi 30 secondi</p>
    `;
  }

  if(r === "Assassino"){
    text = `
      <h3>üíÄ ASSASSINO</h3>
      <p>‚ùå Non conosci la vicenda</p>
      <p>Mimetizzati e inganna gli altri</p>
    `;
  }

  roleCard.innerHTML = text;
  roleCard.classList.remove("hidden");
  nextBtn.classList.remove("hidden");
}

function nextPlayer(){
  currentPlayer++;
  if(currentPlayer >= roles.length){
    roleScreen.classList.add("hidden");
    startTimer();
  } else {
    updateRoleScreen();
  }
}

// TIMER
function startTimer(){
  timerScreen.classList.remove("hidden");
  let time = 180;

  let interval = setInterval(()=>{
    time--;
    let m = String(Math.floor(time/60)).padStart(2,"0");
    let s = String(time%60).padStart(2,"0");
    timer.textContent = `${m}:${s}`;

    if(time === 30){
      hint.classList.remove("hidden");
    }

    if(time <= 0){
      clearInterval(interval);
      timerScreen.classList.add("hidden");
      startVote();
    }
  },1000);
}

// VOTO
function startVote(){
  votePlayer = 0;
  voteScreen.classList.remove("hidden");
  voteButtons.innerHTML = "";

  roles.forEach((r,i)=>{
    if(i !== victim){
      let b = document.createElement("button");
      b.textContent = "Giocatore " + (i+1);
      b.onclick = ()=>castVote(i);
      voteButtons.appendChild(b);
    }
  });
}

function castVote(i){
  votes[i]++;
  votePlayer++;

  if(votePlayer >= roles.length - 1){
    showResult();
  } else {
    alert("Voto registrato. Passa il telefono.");
  }
}

// RISULTATO
function showResult(){
  voteScreen.classList.add("hidden");
  resultScreen.classList.remove("hidden");

  let maxVotes = Math.max(...votes);
  let voted = votes.indexOf(maxVotes);

  if(voted === assassin){
    resultTitle.textContent = "üéâ VINCONO I CIVILI!";
  } else {
    resultTitle.textContent = "üíÄ VINCE L‚ÄôASSASSINO!";
  }

  resultText.textContent = "L‚ÄôAssassino era il Giocatore " + (assassin + 1);
}
</script>

</body>
</html>
